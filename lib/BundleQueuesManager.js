'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.generateAdapterForBundleQueuesManager=exports.BundleQueuesManager=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function generateAdapterForBundleQueuesManager(cursorsManager){var memory={bundles:{},nextBundleIds:{},adapters:[function getCursor(cursorId,callback){if(cursorsManager.cursors[cursorId])callback(cursorsManager.cursors[cursorId])},function getBundle(cursorId,bundleId,callback){var bundle=_lodash2.default.get(memory.bundles,[cursorId,bundleId]);callback(bundle)},function setBundle(bundle){_lodash2.default.set(memory.bundles,[bundle.cursor,bundle.id],bundle)},function unsetBundle(bundle){if(memory.bundles[bundle.cursor]){delete memory.bundles[bundle.cursor][bundle.id]}},function getNextBundleId(cursorId,callback){var nextBundleId=_lodash2.default.get(memory.nextBundleIds,[cursorId]);if(typeof nextBundleId=='number'){callback(nextBundleId)}else{this.setNextBundleId(cursorId,0);callback(0)}},function setNextBundleId(cursorId,nextBundleId){memory.nextBundleIds[cursorId]=nextBundleId}]};return memory}var BundleQueuesManager=function(){function BundleQueuesManager(getCursor,getBundle,setBundle,unsetBundle,getNextBundleId,setNextBundleId){_classCallCheck(this,BundleQueuesManager);this.getCursor=getCursor;this.getBundle=getBundle;this.setBundle=setBundle;this.unsetBundle=unsetBundle;this.getNextBundleId=getNextBundleId;this.setNextBundleId=setNextBundleId}_createClass(BundleQueuesManager,[{key:'useBundle',value:function useBundle(bundle,callback){var _this=this;this.getNextBundleId(bundle.cursor,function(nextBundleId){if(bundle.id==nextBundleId){_this.executeBundle(bundle,callback)}else{if(bundle.id>nextBundleId){_this.setBundle(bundle)}if(callback)callback()}})}},{key:'executeBundle',value:function executeBundle(bundle,callback){var _this2=this;this.getCursor(bundle.cursor,function(cursor){if(cursor){switch(bundle.type){case'set':cursor.set(bundle.path,bundle.value);break;case'unset':cursor.set(bundle.path,undefined);break;case'splice':cursor.splice.apply(cursor,[bundle.path,bundle.start,bundle.deleteCount].concat(_toConsumableArray(bundle.items)));break;default:throw new Error('Bundle type "'+bundle.type+'" is unexpected.');}_this2.unsetBundle(bundle);_this2.setNextBundleId(bundle.cursor,bundle.id+1);_this2.getBundle(bundle.cursor,bundle.id+1,function(bundle){if(bundle)_this2.executeBundle(bundle,callback);else if(callback)callback()})}else if(callback)callback()})}}]);return BundleQueuesManager}();exports.BundleQueuesManager=BundleQueuesManager;exports.generateAdapterForBundleQueuesManager=generateAdapterForBundleQueuesManager;
//# sourceMappingURL=BundleQueuesManager.js.map
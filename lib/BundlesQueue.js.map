{"version":3,"sources":["../src/lib/BundlesQueue.js"],"names":["BundlesQueue","nextId","handling","queue","id","task","handleNext","_handler","done","Error"],"mappings":"itBAAA;;;;;MAMMA,a,YAEJ;;KAGA,uBAAc,oCACZ,KAAKC,MAAL,CAAc,CAAd,CACA,KAAKC,QAAL,CAAgB,KAAhB,CACA,KAAKC,KAAL,CAAa,EACd,CAED;;;;0EAKUC,E,CAAIC,I,CAAM,CAClB,KAAKF,KAAL,CAAWC,EAAX,EAAiBC,IAAjB,CACA,KAAKC,UAAL,EACD,CAED;;;;oDAKa,gBACX;;OAGA,GAAI,KAAKJ,QAAT,CAAmB,OACnB,GAAI,KAAKC,KAAL,CAAW,KAAKF,MAAhB,CAAJ,CAA6B,CAC3B,KAAKC,QAAL,CAAgB,IAAhB,CACA,KAAKK,QAAL,CAAc,KAAKN,MAAnB,CAA2B,KAAKE,KAAL,CAAW,KAAKF,MAAhB,CAA3B,CAAoD,UAAM,CACxD,MAAKC,QAAL,CAAgB,KAAhB,CACA,MAAO,OAAKC,KAAL,CAAW,MAAKF,MAAhB,CAAP,CACA,MAAKA,MAAL,GACA,MAAKK,UAAL,EACD,CALD,CAMD,CACF,CAED;;+CAGSF,E,CAAIC,I,CAAMG,I,CAAM,CACvB,KAAM,IAAIC,MAAJ,CAAU,oCAAV,CACP,C,2CAGYT,Y","file":"BundlesQueue.js","sourcesContent":["/**\n * Queue of bundles execution.\n * You must override _handler, for parse bandles for your cursors.\n * @class\n * @memberof module:ancient-cursor\n */\nclass BundlesQueue {\n  \n  /**\n   * @constructs BundlesQueue\n   */\n  constructor() {\n    this.nextId = 0;\n    this.handling = false;\n    this.queue = {};\n  }\n  \n  /**\n   * Add received bundles into queue.\n   * @param {number} id\n   * @param task - Any data for your _handler.\n   */\n  addBundle(id, task) {\n    this.queue[id] = task;\n    this.handleNext();\n  }\n  \n  /**\n   * Handle next possible bundle from queue.\n   * Do not do anything if there is no next mandatory bundle in queue.\n   * It is called automatically current each {@link BundlesQueue#addBundle}\n   */\n  handleNext() {\n    /**\n     * @todo May be need protect from call stack, as timeout 0 or some think as...\n     */\n    if (this.handling) return;\n    if (this.queue[this.nextId]) {\n      this.handling = true;\n      this._handler(this.nextId, this.queue[this.nextId], () => {\n        this.handling = false;\n        delete this.queue[this.nextId];\n        this.nextId++;\n        this.handleNext();\n      });\n    }\n  }\n  \n  /**\n   * You must overrided this method, which would somehow handle each bandle.\n   */\n  _handler(id, task, done) {\n    throw new Error('Method _handler must be overrided.');\n  }\n}\n\nexport default BundlesQueue;"]}
{"version":3,"sources":["../../src/lib/adapters/object.js"],"names":["factoryObjectGraph","ParentClassGraph","ObjectGraph","collection","fields","config","arguments","emitter","index","link","_modifier","f","aliases","callback","context","_insertModifier","error","id","push","hasOwnProperty","_idGenerator","emit","_error","data","item","isArray","i","_updateModifierAdd","indexOf","_updateModifierPush","_updateModifierRemove","remove","value","modifier","result","m","key","selector","results","_fetch","r","oldResult","cloneDeep","_updateModifier","undefined","length","oldLength","removed","_query","query","newLength","type","doc","s","includes","options","_options","sort","keys","orders","skip","limit","document","fetch","documents","filter","orderBy","slice","links","d","_generateLink","l","map","event","subscriptions","addListener","newDocument","oldDocument","subscription","Graph"],"mappings":"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","file":"object.js","sourcesContent":["import { Graph as AncientGraph } from '../graph.js';\nimport lodash from 'lodash';\nimport { EventEmitter } from 'fbemitter';\n\n/**\n * This method allows you to use ObjectGraph class to its inheritance chain.\n *\n * @param {Class} ParentClassGraph\n * @return {Class} ObjectGraph\n */\nfunction factoryObjectGraph(ParentClassGraph) {\n  /**\n   * Inherited class. Class with methods for control links in graph.\n   * Adapted for array collection.\n   * \n   * @class\n   * @description `import { ObjectGraph as Graph } from 'ancient-graph';`\n   */\n  class ObjectGraph extends ParentClassGraph {\n    \n    /**\n     * Construct new graph and checks for required adaptation methods.\n     * @param {Array[]} collection\n     * @param {Object.<string, string>} fields - matching of fields in the link with fields in document\n     * @param {Object} [config] - Additional config.\n     * @param {Object} [config.aliases]\n     * @param {String} [config.aliases.$]\n     * @throws {Error} if the adapter methods is not complete\n     */\n    constructor(collection, fields, config) {\n      super(...arguments);\n      this.emitter = new EventEmitter();\n    }\n    \n    /**\n     * Specifies the id field on insert\n     * \n     * @param {number} index\n     * @param {Link} link\n     * @return {number|string} id;\n     */\n    _idGenerator(index, link) {\n      return \"\"+index;\n    };\n    \n    /**\n     * Generate insert modifier.\n     * \n     * @param {number} index\n     * @param {Link} link\n     * @return {number|string} id;\n     */\n    _insertModifier(link) {\n      var _modifier = {};\n      for (var f in link) {\n        if (this.fields[f]) {\n          _modifier[this.fields[f]] = link[this.config.aliases[f]];\n        }\n      }\n      return _modifier;\n    };\n    \n    /**\n     * Should insert new link into graph.\n     * Return a synchronous result. This can be useful in your application. But for writing generic code, it is recommended to only use the callback result.\n     * \n     * @param {Link} link\n     * @param {Graph~insertCallback} [callback]\n     * @param {Object} [context]\n     * @return {number|string} [id]\n     */\n    insert(link, callback, context) {\n      this.callback\n      var _modifier = this._insertModifier(link);\n      var index, error, id;\n      try {\n        index = this.collection.push(_modifier) - 1;\n        if (!this.collection[index].hasOwnProperty(this.fields[this.config.aliases['id']])) {\n          id = this.collection[index][this.fields[this.config.aliases['id']]] = this._idGenerator(index, this.collection[index]);\n        }\n        this.emitter.emit('insert', this.collection[index]);\n      } catch(_error) {\n        error = _error;\n      }\n      if (callback) {\n        callback(error, id)\n      }\n      return id;\n    }\n    \n    /**\n     * Optional callback. If present, called with an error object as the first argument and, if no error, the unique id of inserted link as the second.\n     *\n     * @callback Graph~insertCallback\n     * @param {Error} [error]\n     * @param {number|string} [id]\n     */\n    \n    /**\n     * Push into link value some item/items.\n     * \n     * @param {Array} data\n     * @param {string|number|string[]|number[]} item\n     */\n    _updateModifierPush(data, item) {\n      data.push(item);\n    }\n    \n    /**\n     * Push into link value some item/items if not already exists.\n     * \n     * @param {Array} data\n     * @param {string|number|string[]|number[]} item\n     */\n    _updateModifierAdd(data, item) {\n      if (lodash.isArray(item)) {\n        for (var i in item) {\n          this._updateModifierAdd(data, item[i]);\n        }\n      } else {\n        var index = lodash.indexOf(data, item);\n        if (index < 0) {\n          this._updateModifierPush(data, item);\n        }\n      }\n    }\n     \n    /**\n     * Remove from link value some item/items.\n     * \n     * @param {Array} data\n     * @param {string|number|string[]|number[]} item\n     */\n    _updateModifierRemove(data, item) {\n      if (lodash.isArray(item)) {\n        for (var i in item) {\n          this._updateModifierRemove(data, item[i]);\n        }\n      } else {\n        lodash.remove(data, function(value) {\n          return value == item;\n        });\n      }\n    }\n  \n    /**\n     * Generate update modifier.\n     * \n     * @param {LinkModifier} modifier \n     * @param {Object} result\n     * @return {number|string} id;\n     */\n    _updateModifier(modifier, result) {\n      for (var m in modifier) {\n        if (this.fields[m]) {\n          if (typeof(modifier[m]) == 'undefined') {\n            delete result[this.fields[m]];\n          } else {\n            if (typeof(modifier[m]) == 'object') {\n              if (lodash.isArray(modifier[m])) {\n                result[this.fields[m]] = modifier[m];\n              } else {\n                if (!lodash.isArray(result[this.fields[m]])) {\n                  result[this.fields[m]] = result[this.fields[m]]?[result[this.fields[m]]]:[];\n                }\n                for (var key in modifier[m]) {\n                  if (key == 'add') {\n                    this._updateModifierAdd(result[this.fields[m]], modifier[m][key]);\n                  }\n                  if (key == 'push') {\n                    this._updateModifierPush(result[this.fields[m]], modifier[m][key]);\n                  }\n                  if (key == 'remove') {\n                    this._updateModifierRemove(result[this.fields[m]], modifier[m][key]);\n                  }\n                }\n              }\n            } else {\n              result[this.fields[m]] = modifier[m];\n            }\n          }\n        }\n      }\n    };\n    \n    /**\n     * Should update to new state of modifier object link by unique id or by link query object.\n     * If the database allows, it is recommended to return a synchronous result. This can be useful in your application. But for writing generic code, it is recommended to only use the callback result.\n     * \n     * @param {string|LinkSelector} selector\n     * @param {LinkModifier} modifier\n     * @param {Graph~updateCallback} [callback]\n     * @param {Object} [context]\n     * @return {number} [count]\n     */\n    update(selector, modifier, callback, context) {\n      var results = this._fetch(selector);\n      for (var r in results) {\n        var oldResult = lodash.cloneDeep(results[r]);\n        this._updateModifier(modifier, results[r]);\n        this.emitter.emit('update', results[r], oldResult);\n      }\n      if (callback) callback(undefined, results.length);\n      return results.length;\n    }\n    \n    /**\n     * Optional callback. If present, called with an error object as the first argument and, if no error, the number of affected documents as the second.\n     *\n     * @callback Graph~updateCallback\n     * @param {Error} [error]\n     * @param {number} [count]\n     */\n    \n    /**\n     * Should remove link by unique id or by link query object.\n     * \n     * @param {string|LinkSelector} selector\n     * @param {Graph~removeCallback} [callback]\n     * @param {Object} [context]\n     */\n    remove(selector, callback, context) {\n      var oldLength = this.collection.length;\n      var removed = [];\n      lodash.remove(this.collection, (result) => {\n        var _query = this.query(selector)(result);\n        if (_query) removed.push(result)\n        return _query;\n      });\n      for (var r in removed) {\n        this.emitter.emit('remove', removed[r]);\n      }\n      var newLength = this.collection.length;\n      if (callback) callback(undefined, oldLength - newLength);\n    }\n    \n    /**\n     * Optional callback. If present, called with an error object as the first argument.\n     *\n     * @callback Graph~removeCallback\n     * @param {Error} [error]\n     * @param {number} [count]\n     */\n    \n    /**\n     * Generate adapter for database query for links search by unique id or by link query object.\n     * \n     * @param {string|LinkSelector} selector\n     * @return {*} query\n     */\n    query(selector) {\n      var type = typeof(selector);\n      if (type == 'string' || type == 'number') {\n        return (doc) => { return doc[this.fields[this.config.aliases['id']]] == selector };\n      } else if (type == 'object') {\n        return (doc) => {\n          if (typeof(doc) != 'object') return false;\n          for (var m in selector) {\n            if (this.fields[m]) {\n              if (typeof(selector[m]) == 'undefined') {\n                if (doc.hasOwnProperty(this.fields[m])) return false;\n              } else {\n                if (lodash.isArray(doc[this.fields[m]])) {\n                  if (lodash.isArray(selector[m])) {\n                    for (var s in selector[m]) {\n                      if (!lodash.includes(doc[this.fields[m]], selector[m][s])) {\n                        return false;\n                      }\n                    }\n                  } else {\n                    if (!lodash.includes(doc[this.fields[m]], selector[m])) {\n                      return false;\n                    }\n                  }\n                } else {\n                  if (doc[this.fields[m]] != selector[m]) return false;\n                }\n              }\n            }\n          }\n          return true;\n        }\n      }\n    }\n    \n    /**\n     * Generate adapted for database options object.\n     * \n     * @param {Object} [options]\n     * @return {*} options - a options suitable for the database\n     */\n    options(options) {\n      var _options = {};\n      if (options) {\n        if (options.sort) {\n          _options.sort = { keys: [], orders: [] };\n          for (var s in options.sort) {\n            if (this.fields[s]) {\n              _options.sort.keys.push(this.fields[s]);\n              _options.sort.orders.push(options.sort[s]?'asc':'desc');\n            }\n          }\n        }\n        if (typeof(options.skip) == 'number') {\n          _options.skip = options.skip;\n        }\n        if (typeof(options.limit) == 'number') {\n          _options.limit = options.limit;\n        }\n      }\n      return _options;\n    }\n    \n    /**\n     * Generate Link from document by fields.\n     * \n     * @param {Object} document\n     * @return {Link} link\n     */\n    _generateLink(document) {\n      var link = {};\n      for (var f in this.fields) {\n        if (document.hasOwnProperty(this.fields[f])) {\n          link[f] = document[this.fields[f]];\n        }\n      }\n      return link;\n    }\n    \n    /**\n     * Get one first matching link.\n     * \n     * @param {string|LinkSelector} selector\n     * @param {SelectOptions} [options]\n     * @param {Graph~getCallback} [callback]\n     * @return {Link} link - result link object\n     */\n    get(selector, options, callback) {\n      var results = this.fetch(selector, options, (error, results) => {\n        if (callback) callback(error, results?results[0]:undefined);\n      });\n      if (results) return results[0];\n    }\n    \n    /**\n     * Fetch native database documents.\n     * \n     * @param {string|linkSelector} selector\n     * @param {SelectOptions} [options]\n     * @return {Object[]} documents - result documents\n     */\n    _fetch(selector, options) {\n      var query = this.query(selector);\n      var documents = lodash.filter(this.collection, query); \n      var _options = this.options(options);\n      if (_options.sort) documents = lodash.orderBy(documents, _options.sort.keys, _options.orders);\n      var skip = _options.skip?_options.skip:0;\n      var limit = _options.limit?skip+_options.limit:_options.limit;\n      documents = documents.slice(skip, limit);\n      return documents;\n    }\n    \n    /**\n     * Find and all matching links as an Array.\n     * \n     * @param {string|LinkSelector} selector\n     * @param {SelectOptions} [options]\n     * @param {Graph~fetchCallback} [callback]\n     * @return {Link[]} links - result links objects in array\n     */\n    fetch(selector, options, callback) {\n      var documents = this._fetch(selector, options);\n      var links = [];\n      for (var d in documents) {\n        links.push(this._generateLink(documents[d]));\n      }\n      if (callback) callback(undefined, links);\n      return links;\n    }\n    \n    /**\n     * Optional callback. If present, called with an error object as the first argument and, if no error, the result links objects in array.\n     *\n     * @callback Graph~fetchCallback\n     * @param {Error} [error]\n     * @param {Link[]} [links]\n     */\n    \n    /**\n     * Should call callback once for each matching document, sequentially and synchronously.\n     * \n     * @param {string|LinkSelector} selector\n     * @param {SelectOptions} [options]\n     * @param {Graph~eachCallback} [callback]\n     */\n    each(selector, options, callback) {\n      var links = this.fetch(selector, options);\n      for (var l in links) {\n        callback(links[l]);\n      }\n    }\n    \n    /**\n     * @callback Graph~eachCallback\n     * @param {Link} [link]\n     */\n    \n    /**\n     * Map callback over all matching documents. Returns an Array.\n     * \n     * @param {string|LinkSelector} selector\n     * @param {SelectOptions} [options]\n     * @param {Graph~mapCallback} [callback]\n     * @return {Array} results\n     */\n    map(selector, options, callback) {\n      var links = this.fetch(selector, options);\n      return links.map(callback);\n    }\n    \n    /**\n     * @callback Graph~mapCallback\n     * @param {Link} [link]\n     * @return {*} result\n     */\n    \n    /**\n     * Count all matching documents.\n     * \n     * @param {string|LinkSelector} selector\n     * @param {SelectOptions} [options]\n     * @param {Graph~countCallback} [callback]\n     * @return {number} [count]\n     */\n    count(selector, options, callback) {\n      var links = this.fetch(selector, options);\n      if (callback) callback(undefined, links.length);\n      return links.length;\n    }\n    \n    /**\n     * @callback Graph~countCallback\n     * @param {Error} [error]\n     * @param {number} [count]\n     */\n    \n    /**\n     * Should subscribe to the events: link, unlink, insert, update, remove.\n     * \n     * @param {string} event - One event name\n     * @param {Graph~onCallback} callback\n     * @returns {Function} Stops event subscription.\n     * @example\n     * var counter = 0;\n     * var stop = graph.on('update', (oldData, newData) => {\n     *   if (oldData.id == '1') console.log(oldData.id, 'is changed');\n     *   counter++;\n     *   if (counter == 3) stop();\n     * });\n     */\n    on(event, callback) {\n      var subscriptions = [];\n      \n      if (event == 'insert') {\n        subscriptions.push(this.emitter.addListener('insert', (document) => {\n          callback(undefined, this._generateLink(document));\n        }));\n      }\n      if (event == 'update') {\n        subscriptions.push(this.emitter.addListener('update', (newDocument, oldDocument) => {\n          callback(this._generateLink(oldDocument), this._generateLink(newDocument));\n        }));\n      }\n      if (event == 'remove') {\n        subscriptions.push(this.emitter.addListener('remove', (document) => {\n          callback(this._generateLink(document), undefined);\n        }));\n      }\n      if (event == 'link') {\n        subscriptions.push(this.emitter.addListener('insert', (document) => {\n          callback(undefined, this._generateLink(document));\n        }));\n        subscriptions.push(this.emitter.addListener('update', (newDocument, oldDocument) => {\n          callback(this._generateLink(oldDocument), this._generateLink(newDocument));\n        }));\n      }\n      if (event == 'unlink') {\n        subscriptions.push(this.emitter.addListener('update', (newDocument, oldDocument) => {\n          callback(this._generateLink(oldDocument), this._generateLink(newDocument));\n        }));\n        subscriptions.push(this.emitter.addListener('remove', (document) => {\n          callback(this._generateLink(document), undefined);\n        }));\n      }\n      \n      return () => {\n        for (var subscription of subscriptions) {\n          subscription.remove();\n        }\n      };\n    }\n    \n    /**\n     * @callback Graph~onCallback\n     * @param {Link} [oldLink] - can be undefined on link and insert events\n     * @param {Link} [newLink] - can be undefined on unlink and remove events\n     * @param {Object} [context] - additional app information, such as context.userId\n     */\n  }\n  \n  return ObjectGraph;\n};\n\nvar ObjectGraph = factoryObjectGraph(AncientGraph);\n\nexport { factoryObjectGraph, ObjectGraph as Graph };"]}